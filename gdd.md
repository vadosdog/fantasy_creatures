### **Game Design Document (GDD) — "Рунные Осколки"**

**Версия:** 3.0 (Final)

---

## **1. Концепция и сеттинг**

### **1.1. Лор и мир**

**Сеттинг:**  
Мир, где боги погибли, а их сны, мечты и воспоминания материализовались в виде **Рунных Осколков** — кристаллов,
хранящих обрывки памяти.
Игрок — **Мастер Осколков**, способный создавать из них существ и пробуждать забытые легенды.

**Ключевые элементы:**

- **Осколки:**
    - Разделены на **стихии** (огонь, вода, трава), **формы** (зверь, птица, рептилия) и **эмоции** (ярость, азарт,
      надежда).
    - Редкость: обычные (белые), редкие (синие), легендарные (золотые).
- **Существа:**
    - Ожившие легенды богов. Каждое имеет **4 эволюции**, завершающиеся пробуждением.
- **Локации:**
    - Статичные зоны (лес, пещеры, вулкан) и **Олимп** — финальная локация, открываемая после пробуждения 6 существ.

**Тон повествования:**  
Мистический, с отсылками к мифам. Пример диалога NPC:  
*"Ты слышишь их шёпот? Осколки зовут тебя... но будь осторожен. Некоторые сны лучше не тревожить."*

### **2. Основные механики**

#### **2.1. Система команд и битв**

##### **Основные правила**

- **Формат:** Пошаговые сражения 6×6 на гексагональной сетке 16х11.
- **Очередность хода:** Зависит от параметра «Инициатива» существ.
- **Дальность хода:** Зависит от характеристики существа speedStat
- **Дальность атак/способностей:**
    - Ближний бой (1 клетка).
    - Дальний бой (до 30 клеток).

##### **Механика Power Points (PP)**

Использование PP:

- Каждое существо имеет запас PP устанавливаемое его характеристикой Макс. PP
- Каждый навык имеет стоимость в PP (указана в описании навыка).
- Если PP недостаточно — навык нельзя использовать.
- В начале хода каждое существо восстанавливает количество PP, определяемое его характеристикой Регенерация PP

##### **Эффекты (бафы/дебафы)**

Все эффекты накладываются на какую-то длительность ходов, в зависимости от конкретного навыка.
Эффекты не стекаются, а увеличивают продолжительность. Нельзя наложить больше 3х бафов и 3 дебафов на существо, при
попытке наложить четвертый ничего не происходит

| Тип        | Название     | Эффект                                      |  
|------------|--------------|---------------------------------------------|
| **Бафы**   | Усиление     | +10% урона                                  |  
|            | Ускорение    | +2 к дальности перемещения                  |  
|            | Удача        | Шанс крита на +15%                          |  
|            | Регенерация  | Увеличивает здоровье каждый ход             |  
|            | Шипы         | Возвращает 20% полученного урона атакующему |  
|            | Щит          | Увеличивает защиту на 10%                   |  
| **Дебафы** | Яд           | 5% макс. HP за ход                          |  
|            | Кровотечение | 8% макс. HP за ход (лечение снимает)        |  
|            | Поджог       | защита -15%, -7%HP каждый ход               |  
|            | Безумие      | +20% атаки, -15% защиты, 10% HP за ход      |
|            | Заморозка    | Уменьшает дальность хода на 1               |
|            | Ослеплен     | Шанс атаки -25%                             |
|            | Проклят      | Проклятие снижает max HP на 10%             |
|            | Страх        | -15% к атаке                                |

##### **Стихийные взаимодействия**

- **Модификаторы урона:**
    - Сильная стихия: ×1.5.
    - Слабая стихия: ×0.75.
    - Нейтральные атаки-атаки: ×1 (кроме будущих духов).

##### **Формулы:**

1. **Шанс попадания:**
   Не может быть ниже 5% и больше 99%, независимо от бафов и дебафов, всегда шанс промаха или попадания
   ```
   hitChance = max(0.05, min(0.99, 
     skill.hitChance
   ))
   ```

2. **Шанс крита:**
   Не может быть больше 25%, независимо от бафов
   ```
   critChance = min(0.25, max(0, 
     skill.critChance + 
     (attacker.willStat - defender.willStat) / 100
   ))
   ```

3. **Урон:**
   Не может быть ниже 30% от базового урона
   ```
   damage = max(
     skill.baseDamage * 0.3,
     floor(
       skill.baseDamage * 
       (attacker.attackStat / defender.defenseStat) * 
       elementModifier * 
       (isCrit ? 1.2 : 1)
     )
   )
   ```

4. **Лечение:**  
   *(Аналогично урону, но `baseDamage` → `baseHeal`)*

5. **Наложение эффектов:**
    - На себя: `effect.chance` (без проверок).
    - На врага:
      ```
      effectChance = max(0, 
        effect.chance + 
        (attacker.willStat - defender.willStat) / 100
      )
      ```

##### **Состав команды:**

- В каждой битве участвует **до 6 существ**, ограничения из уровня битвы:
    - **3-6 существ** должны соответствовать требуемой эволюции для выбранной сложности.
    - **до 2 существ** могут быть на 1 эволюцию ниже (но не более 3х уровней от нужной эволюции)
    - **максимум 1 существо** может быть на 1 эволюцию выше (но не более 3х уровней от эволюции)

##### **Процесс выбора существ:**

1. В PvE:
    - Игрок видит предварительный состав противника.
    - Выбирает 6 существ с учётом ограничений эволюции.
2. В PvP:
    - Поочерёдный драфт: игроки запрещают и выбирают существ (1-1-1-1-1-1).

##### **Локационные эффекты в битве:**

| Локация       | Эффект                                                                          |  
|---------------|---------------------------------------------------------------------------------|  
| Болота        | Замедление (-1 к скорости) для всех, кроме водных существ, игнорируется птицами |  
| Возвышенности | +15% к дальности атак, +10% к точности атак                                     |  
| Вулкан        | Огненные атаки +15%, но водные -15%                                             |  
| Лес           | Шанс 5% наложения "Яда" при начале движения                                     |

_будет дополняться._

**Пример тактики:**  
В локации "Болота" выгодно брать водных существ с высокой скоростью, чтобы игнорировать штрафы.

---

##### Очередность хода существ

Битва разделена на раунды. В начале раунда очередь выстраивается в порядке инициативы существ. На инициативу могут
влиять бафы и дебафы наложенные на существо, поэтому после каждого хода инициатива пересчитывается, поэтому порядок
может измениться. В свой ход существо может

- переместиться на дальность своего хода
- атаковать ближней атакой существо в соседней ячейке
- переместиться и атаковать ближней атакой
- атаковать дальней атакой на расстояние определенное дальностью атаки существа
- наложить баф на себе или союзника на расстояние определенное дальностью бафа
- занять защитную стойку, тогда защита существа увеличится на 10%, а инициатива увеличится на 20% до хода существа в
  следующем раунде (баф defense 2)
- отложить ход, тогда игрок выбирает после кого в этом раунде он хочет походить. Тогда инициатива уменьшится на 20% до
  хода существа в следующем раунде (дебаф Растерянность 3)

#### **2.2. Крафт существ**

**Процесс:**

1. Игрок выбирает **3 осколка** (стихия + форма + эмоция).
2. Нажимает "Создать" → система генерирует существо с:
    - **Базовыми характеристиками** (зависят от редкости осколков) +/- N разброс зависит от роли и характеристики.
    - **1-2 стартовыми навыками**.
    - **Уровень 1**
    - **0 опыта**
    - **0 Силы Пробуждения (очков для улучшения характеристик).**

**Начальные характеристики**
Зависит от конкретного существа и так же к ним применяется следующий разброс.

| Характеристика     | Rage (Ярость) | Passion (Азарт) | Hope (Надежда) |  
|--------------------|---------------|-----------------|----------------|  
| **Здоровье (HP)**  | 15            | 10              | 10             |  
| **Атака**          | 10            | 5               | 10             |  
| **Защита**         | 20            | 5               | 15             |  
| **Воля**           | 10            | 15              | 30             |  
| **Инициатива**     | 20            | 20              | 20             |  
| **Скорость**       | 0             | 0               | 0              |  
| **Макс. PP**       | 1             | 1               | 2              |  
| **Регенерация PP** | 1             | 1               | 1              |

**Формула качества:**

```  
Бонус к статам = (Кол-во редких осколков × 3%) + (Кол-во легендарных × 10%)  
```  

**Пример:**

- 2 редких + 1 обычный → +20% к максимальным статам.

**Легендарные существа:**

- Требуют **3 легендарных осколка**.
- Имеют уникальные навыки (например, "Феникс" воскресает 1 раз за бой).

---

#### **2.3. Эволюция и пробуждение**

**Этапы прокачки:**  
| Уровни | Эволюция | Изменения |  
|--------|----------|-----------|  
| 1-10 | 1 | Базовая форма |  
| 11-20 | 2 | Новый навык + улучшенная анимация |  
| 21-30 | 3 | Легендарный облик + пассивный эффект |  
| 30+ | 4 (Пробуждение) | Существо покидает команду, давая бонусы |

**После пробуждения:**

- **Перманентный бонус** (например, +5% к атаке всех огненных существ).
- **Легендарный осколок** для крафта.
- **Запись в Библиотеке Легенд** (открывает новые комбинации).

**Артефакт "Цепь Памяти":**

- Блокирует пробуждение.
- Даёт +2 слота для навыков существу.

---

#### **2.4. Слияние существ**

- Объединение **2+ одинаковых существ** усиливает их:
    - +5% к основным статам за каждое.
    - Максимум: +30% (6 существ).
- **Лор-обоснование:** *"Осколки тянутся друг к другу, становясь цельным воспоминанием."*

---

#### **2.5. Исследование (Исследование Эхо Снов)**

> Как Мастер Осколков, вы чувствуете Эхо - застывшие в материи обрывки снов богов. 
> Запуская Исследование Эхо Снов, вы концентрируетесь на этих вибрациях прошлого. 
> Но будьте осторожны: иногда вместо безобидных осколков памяти 
> вы можете потревожить Кошмары - одичавшие фрагменты забытых кошмаров богов. 
> Самые удачливые находят Разломы Сновидений - порталы в неизведанные слои реальности.

Исследование представляет собой ритуал.  В котором игрок входит в транс и путешествует по снам богов. 
Во время путешествия он может добыть новые ресурсы, получить важное для какого-то квеста воспоминание, 
встретить кошмары (битвы) или почувствовать подсказки, как открыть скрытый проход. 
Доступно в некоторых локациях, где сильнее чувствуется память богов.

**Процесс:**
1. Игрок запускает "Эховый Поиск" на локации (если доступно):
    - Запускается невидимый таймер (1-30 сек) со случайным результатом
    - Возможные исходы:
        - Ресурсы
        - Битвы с кошмарами
        - Секретный проход
        - Квестовая информация

**Артефакты поиска:**
| Название | Эффект |
|----------|--------|
| Око Хранителя | +% шанс ресурсов |
| Сердце Воителя | +% шанс Кошмаров, +% наград за бой |
| Нить Ариадны | +% шанс Разломов Сновидений |

---

### **3. Прогрессия и баланс**

#### **3.1. Система сложности**

**Уровни сложности:**  
| Уровень | Требования | Особенности | Награды |  
|---------|------------|-------------|---------|  
| Новичок | Эволюция 1 | Противники на 10% слабее | Обычные осколки, базовые ресурсы |  
| Эксперт | Эволюция 2 | Стандартная сила врагов | Редкие осколки, +20% золота |  
| Мастер | Эволюция 3 | Противники на 15% сильнее | Легендарные осколки (10% шанс), артефакты |  
| Легенда | 6 пробуждённых существ уровня 30 | Уникальные механики боссов | Гарантированный легендарный осколок,
титулы |

**Доступ по эволюциям:**

- Для выбора сложности необходимо иметь **3+ существа** требуемой эволюции.
- Пример: для "Мастера" нужны 3 существа 3-й эволюции.

---

#### **3.2. Прокачка существ**

**Термины**
**Эхо Битв** (ЭБ) - Боевой опыт. Получается за действия в бою. Накопление открывает доступ к уровням.
**Осколки Памяти** (ОП) - Ресурс для повышения уровня. Добывается в боях, квестах, PvP.
**Сила Пробуждения** (СП) - Очки, выдаваемые при повышении уровня. Тратятся на ручное улучшение характеристик

##### **Получение Эха Битв (ЭБ):**

```
ЭБ = min(150, 
     (Урон / 10) + (Лечение / 8) + (Бафы/Дебафы × 5)
) * (1 + 0.01 × Уровень противника/союзника)
```

- Начисляется только участвовавшим в бою существам.
- Максимум за бой: 150 ЭБ.

##### **Повышение уровня**

Стоимость_уровня = 50 + 10 * floor(Текущий_уровень / 3)
Макс_уровень = min(30, 5 + floor(Накопленное_Эхо_Битв / 600))

**Автоматический рост характеристик**
За каждый уровень: +3% к базовым статам кроме скорости.
Характеристика = Базовая_характеристика × Math.pow(2, (newLevel - 1) / 7.5)

##### **Ручное улучшение (Сила Пробуждения)**

За уровень даётся 4 очка Силы Пробуждения
1 очко = +1 к характеристике (атака, защита, HP, воля). Кроме скорости
Лимит: +100 к базовому значению характеристики

**Пример прокачки:**
Существо (базовая атака = 50):
Уровень 10: авто-рост = 50 × 1.27 = 63.5 → 64
Ручное улучшение: +30 → 94 атаки.



---

#### **3.3. Экономика**

**Ресурсы:**

1. **Золото:**
    - Источники: победы, продажа существ, квесты.
    - Траты: покупка осколков, артефактов.
    - Дроп:
        - В тренировочной комнате: золото = round((ср. уровень противника) × (количество противников) × random(0.9, 1.1))
2. **Осколки крафта:**
    - Дроп:
        - PvE-победа
            - гарантированные_осколки = ceil(количество_существ_противника)
            - случайные_осколки = random(0, round(средний_уровень / 3))
            - 90% шанс осколки из осколков противников, 10% другие
3. **Осколки Памяти**
    - Дроп:
        - В тренировочной комнате: round(10 * (количество_существ_противника) × (средний_уровень) × 0.7)
        - PvP-победа 40 + 5 × Ранг_противника
        - Ежедневные квесты 100-300
4. **Эхо Битв**
    - Дроп:
        - Участие в бою. Рассчёт по формуле (раздел 3.2)

**Баланс прогресса**
Прокачка до уровня 30:

Требует 15,000 ЭБ и 12,000 Осколков Памяти.

Для казуальных игроков: 2-3 недели (при 5 боях/день).

**Магазин:**  
| Предмет | Цена (золото) |  
|---------|---------------|  
| Осколок крафта | 50 золота |  
| Осколок памяти (1ед) | 50 золота |  
| Редкий осколок крафта | 500 |  
| Артефакт | 2000-5000 |

---

### **4. Контент и локации**

#### **4.1. Основные зоны**

1. **Лес Плачущих Столпов:**
    - Стихия: Трава.
    - Уникальный эффект: "Яд" (-5% HP за ход).
    - Босс: "Лесной Страж" (массовый яд).

2. **Пещеры Голодных Теней:**
    - Стихия: Тьма.
    - Эффект: "Страх" (-15% к атаке).
    - Босс: "Тень Предателя" (крадет HP).

3. **Руины Алхимической Башни:**
    - Стихия: Огонь.
    - Эффект: "Поджог" (-10% HP за ход).
    - Босс: "Пламенный Дракон" (криты поджигают).

4. **Олимп (финал):**
    - Доступ после пробуждения 6 существ.
    - Уникальные бои с "Тенями Богов".
    - Награда: **Артефакты судьбы** (усиливают всех существ).

---

#### **4.2. PvP и события**

- **Арена:**
    - Режимы: 1×1, 3×3, 6×6.
    - Рейтинги и сезонные награды.
- **Легендарные битвы:**
    - Раз в неделю — сражение с усиленным боссом.
    - Требует пробужденных существ.
    - гарантированные Осколки Памяти (200-500)
- PvP-награды:
    - +50% Осколков Памяти за победу.
- Ивенты:
    - Weekend-ивент: +50% к Эху Битв

---

### **5. Технические детали**

#### **5.1. Платформа и управление**

- **Движок:** Phaser 3 (браузерная версия).
- **Управление:**
    - WASD — перемещение.
    - Клики — выбор действий.
- **Сетка боя:** Гексагональная (6×6).

#### **5.2. Сохранения**

- Локальные (LocalStorage) + облачные (опционально).
- Автосохранение после:
    - Боя.
    - Крафта.
    - Пробуждения.
    - При распределении Силы Пробуждения
    - Повышении уровня

#### **5.3. Оптимизация**

- **Генерация существ:** Предзагруженные шаблоны + рандомизация.
- **Анимации:** Упрощенные эффекты для слабых устройств.
- **Хранение данных** Прогресс существ (Эхо Битв, Сила Пробуждения) сохраняется в сжатых бинарных структурах.
- **Автосохранение при**
    - Распределении очков Силы Пробуждения.
    - Повышении уровня.

---

### **6. Дорожная карта**

- **Релиз:**
    - 27 существ, 4 локации, PvE.
- **Обновление 1.1:**
    - PvP-арена, 3 новых босса.
- **Обновление 2.0:**
    - Кооперативные рейды, гильдии.
- **Будущее обновление:**
- Цепочки поиска ("Пути Памяти")
- Новые типы артефактов:
    - Песочные Часы Кроноса (-25% времени поиска)
    - Плащ Тихой Тени (-40% шанс Кошмаров)

### Артефакты для прокачки

| Артефакт           | Эффект                                | Источник получения            |
|--------------------|---------------------------------------|-------------------------------|
| Зеркало Сновидений | +25% к Эху Битв за бой                | Рейдовые боссы (5% шанс)      |
| Цепь Вечности      | Игнорирует ограничение макс. уровня   | Пробуждение 3 легендарок      |
| Песочные Часы      | -30% к стоимости повышения уровня     | PvP-достижения (2000 рейтинг) |
| Глаз Пророка	      | +20 к лимиту ручного улучшения статов | Легендарные битвы             |
